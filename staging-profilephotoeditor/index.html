<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Profile Photo Editor</title>

    <!-- Primary Meta Tags -->
    <meta name="title" content="Profile Photo Editor" />
    <meta name="description" content="Profile Photo Editor - Add a LinkedIn-inspired arc banner to your profile photo. Made by Jason Leow @jasonleowsg" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://jasonleow.com/profilephotoeditor" />
    <meta property="og:title" content="Profile Photo Editor" />
    <meta property="og:description" content="Profile Photo Editor - Add a LinkedIn-inspired arc banner to your profile photo. Made by Jason Leow @jasonleowsg" />
    <meta property="og:image" content="https://i.postimg.cc/QdrhqtzM/profilephotoeditor-ogimage.png" />

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://jasonleow.com/profilephotoeditor" />
    <meta property="twitter:title" content="Profile Photo Editor" />
    <meta property="twitter:description" content="Profile Photo Editor - Add a LinkedIn-inspired arc banner to your profile photo. Made by Jason Leow @jasonleowsg" />
    <meta property="twitter:image" content="https://i.postimg.cc/QdrhqtzM/profilephotoeditor-ogimage.png" />

    <!-- Favicon -->
    <link rel="icon" type="image/png" sizes="32x32" href="https://i.postimg.cc/02N5zY4g/profilephotoeditor-icon-v2-64px.png">
    <link rel="icon" type="image/png" sizes="16x16" href="https://i.postimg.cc/02N5zY4g/profilephotoeditor-icon-v2-64px.png">
    
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <script src="https://beamanalytics.b-cdn.net/beam.min.js" data-token="ca50ce69-400d-44f0-a46d-65be6451d243" async></script>

  </head>
  
  <body class="bg-white w-full">
    <div class="flex justify-center">
      <div class="flex flex-col justify-center items-center bg-gray-100 rounded-lg m-10 py-12 px-12">
        <h1 class="text-3xl md:text-4xl text-center uppercase font-bold text-gray-700 mb-2">Profile Photo Editor</h1>
        <div class="text-md text-center font-medium text-gray-500 mb-10 w-3/4">
          Please upload an image first before you start editing.<br>For best results, please use a square photo (for now, while I fix it).
        </div>
        <div class="flex md:space-x-20 flex-wrap justify-center md:flex-nowrap">
          <div class="space-y-4 md:w-1/2">
            <div class="flex flex-col space-y-2">
              <label for="image-upload" class="text-lg font-medium">Upload Image:</label>
              <input type="file" accept="image/*" id="image-upload" class="py-2 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="image-x-shift" class="text-lg font-medium">Image X Shift:</label>
              <input type="number" id="image-x-shift" value="0" step="1" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="image-y-shift" class="text-lg font-medium">Image Y Shift:</label>
              <input type="number" id="image-y-shift" value="0" step="1" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="arc-color" class="text-lg font-medium">Arc Color:</label>
              <div class="flex items-center">
                <input type="color" id="arc-color" value="#BA65D1" class="border-none rounded-l-lg w-12 h-8" />
                <span id="color-code" class="ml-2 text-sm"></span>
              </div>
            </div>
            <div class="flex flex-col space-y-2">
              <label for="arc-start" class="text-lg font-medium">Arc Start Position:</label>
              <input type="number" id="arc-start" value="6.5" step="0.1" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="arc-end" class="text-lg font-medium">Arc End Position:</label>
              <input type="number" id="arc-end" value="1.7" step="0.1" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="text-color" class="text-lg font-medium">Text Color:</label>
              <div class="flex items-center">
                <input type="color" id="text-color" value="#FFFFFF" class="border-none rounded-l-lg w-12 h-8" />
                <span id="text-color-code" class="ml-2 text-sm"></span>
              </div>
            </div>
            <div class="flex flex-col space-y-2">
              <label for="banner-text" class="text-lg font-medium">Banner Text:</label>
              <input type="text" id="banner-text" value="#DESPERATE" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="font-size" class="text-lg font-medium">Font Size:</label>
              <input type="number" id="font-size" value="56" step="1" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="letter-spacing" class="text-lg font-medium">Letter Spacing:</label>
              <input type="number" id="letter-spacing" value="0.6" step="0.01" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
            <div class="flex flex-col space-y-2">
              <label for="word-shift" class="text-lg font-medium">Word Centering:</label>
              <input type="number" id="word-shift" value="0" step="0.01" class="py-2 pl-4 text-sm text-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-gray-600 focus:border-transparent" />
            </div>
          </div>
          <div class="flex flex-col md:w-1/2 mt-4 md:mt-0">
            <div class="space-y-4">
              <canvas id="canvas" class="hidden"></canvas>
              <label for="profile-preview" class="text-lg font-medium">Preview image:</label>
              <div id="profile-container" class="relative w-72 h-72 rounded-full overflow-hidden mb-4">
                <img id="profile-preview" alt="Profile Preview" class="rounded-full" src="https://i.postimg.cc/BQnRbg9s/profile-pic-placeholder-copy.png" />
              </div>
              <button id="download-btn" class="w-full bg-gray-500 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded cursor-not-allowed" disabled>Download Image</button>
            </div>
          </div>
        </div>
        <div class="footer text-center text-sm mt-20 mb-3">
          A project by <a href="https://jasonleow.com" target="_blank" class="text-blue-600 hover:text-blue-800">Jason Leow</a> <a href="https://x.com/jasonleowsg" target="_blank" class="text-blue-600 hover:text-blue-800">@jasonleowsg</a>
        </div>
      </div>
    </div>
  </body>

    <script>
      const imageUpload = document.getElementById("image-upload")
      const imageXShiftInput = document.getElementById("image-x-shift")
			const imageYShiftInput = document.getElementById("image-y-shift")
      const downloadBtn = document.getElementById("download-btn")
      const canvas = document.getElementById("canvas")
      const ctx = canvas.getContext("2d")
      const profilePreview = document.getElementById("profile-preview")
      const arcColorInput = document.getElementById("arc-color")
      const arcStartInput = document.getElementById("arc-start")
      const arcEndInput = document.getElementById("arc-end")
      const textColorInput = document.getElementById("text-color")
      const bannerTextInput = document.getElementById("banner-text")
      const fontSizeInput = document.getElementById("font-size")
      const letterSpacingInput = document.getElementById("letter-spacing")
      const wordShiftInput = document.getElementById("word-shift")

      let image;

      imageUpload.addEventListener("change", function (event) {
        const file = event.target.files[0]
        if (file) {
          const reader = new FileReader()
          reader.onload = function (e) {
            image = new Image()
            image.src = e.target.result
            image.onload = function () {
              const size = 600
              const radius = size / 2

              // Set canvas size to the image size
              canvas.width = size
              canvas.height = size

              updatePreview();
            }
          }
          reader.readAsDataURL(file)
        }
      })
      
      imageXShiftInput.addEventListener("input", function () {
        updatePreview();
      });

      imageYShiftInput.addEventListener("input", function () {
        updatePreview();
      });

      arcColorInput.addEventListener("input", function () {
        updatePreview();
      });
      
      arcStartInput.addEventListener("input", function () {
        updatePreview();
      });
      
      arcEndInput.addEventListener("input", function () {
        updatePreview();
      });
      
      textColorInput.addEventListener("input", function () {
        updatePreview();
      });

      bannerTextInput.addEventListener("input", function () {
        updatePreview();
      });
      
      fontSizeInput.addEventListener("input", function () {
        updatePreview();
      });
      
      letterSpacingInput.addEventListener("input", function () {
        updatePreview();
      });
      
      wordShiftInput.addEventListener("input", function () {
        updatePreview();
      });
      
      // Set default image
      const defaultImage = new Image();
      defaultImage.src = 'placeholder.png'; // Replace with your default image URL https://i.postimg.cc/2y5WYnjF/profile-pic-placeholder-copy.png
      defaultImage.onload = function() {
        profilePreview.src = defaultImage.src;
        profilePreview.style.display = "block";
        image = defaultImage; // Set the image variable to the default image
        canvas.width = 600
        canvas.height = 600
	// setTimeout(updatePreview, 100); // Run updatePreview() after a 100ms delay
	if (canvas.width > 0 && canvas.height > 0) {
    	updatePreview(); // Call updatePreview() directly
	} else {
	setTimeout(updatePreview, 100); // Run updatePreview() after a 100ms delay if canvas is not ready
	}
      };

      function updatePreview() {
        // Clear canvas and create a circular clipping path
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        ctx.save();
        ctx.beginPath();
        ctx.arc(canvas.width / 2, canvas.height / 2, canvas.width / 2, 0, Math.PI * 2, true);
        ctx.closePath();
        ctx.clip();
        
        // Resize the image to a square
        const squareSize = Math.min(image.width, image.height);
        const x = (image.width - squareSize) / 2;
        const y = (image.height - squareSize) / 2;

        // Draw the profile image within the circular clipping path
        // ctx.drawImage(image, 0, 0, canvas.width, canvas.height);
        // ctx.drawImage(image, x, y, squareSize, squareSize, 0, 0, canvas.width, canvas.height);
        // Draw the profile image within the circular clipping path
				ctx.drawImage(image, x + parseFloat(imageXShiftInput.value), y + parseFloat(imageYShiftInput.value), squareSize, squareSize, 0, 0, canvas.width, canvas.height);
        ctx.restore();

        // Create the banner arc (bottom-left quadrant outline with gradient)
        const arcWidth = canvas.width / 2 * 0.3; // Adjust this value to change the thickness of the arc
        const startArcAngle = Math.PI * `${arcStartInput.value}` / 6; // 9 o'clock position
        const endArcAngle = Math.PI * `${arcEndInput.value}` / 6; // 4 o'clock position
        const totalArcAngle = startArcAngle - endArcAngle;
        const steps = 300; // Number of segments to create the gradient effect

        ctx.lineWidth = arcWidth;

        for (let i = 0; i <= steps; i++) {
          const t = i / steps;
          const angle = startArcAngle - t * totalArcAngle;

          // Calculate opacity for solid middle 80% and quick fade at ends
          let opacity;
          if (t < 0.2) {
            opacity = t * 7; // Quick fade in
          } else if (t > 0.7) {
            opacity = (1 - t) * 7; // Quick fade out
          } else {
            opacity = 1; // Solid middle
          }

          ctx.beginPath();
          ctx.arc(
            canvas.width / 2,
            canvas.height / 2,
            canvas.width / 2 - arcWidth / 2,
            angle,
            angle - totalArcAngle / steps,
            true
          );
          ctx.strokeStyle = `rgba(${hexToRgb(arcColorInput.value).r}, ${hexToRgb(arcColorInput.value).g}, ${hexToRgb(arcColorInput.value).b}, ${opacity})`;
          ctx.stroke();
        }

        // Add curved text along the arc
        const text = bannerTextInput.value;
        const textLength = text.length;
        const textRadius = canvas.width / 2 - arcWidth / 2;
        const anglePerChar = (Math.PI * parseFloat(letterSpacingInput.value)) / 10;

        totalAngle = anglePerChar * textLength;

        ctx.font = `bolder ${fontSizeInput.value}px Arial`;
        ctx.fillStyle = textColorInput.value;
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";

        // Calculate the angle for the text arc
        // const startAngle = Math.PI * 1.47; // Start from 9 o'clock
        const startAngle = Math.PI * 1.61 - (totalAngle / 2) + (Math.PI * 0.9 - totalAngle) / 2; // Center the text
        const endAngle = Math.PI * 0.95; // End at 6 o'clock
        const arcAngle = endAngle - startAngle;

        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);

				/*
        for (let i = 0; i < text.length; i++) {
          const angle = startAngle - i * anglePerChar;
          ctx.save();
          ctx.rotate(angle);
          ctx.translate(0, -textRadius);
          ctx.rotate(Math.PI / 1); // Rotate each character to face outward
          ctx.fillText(text[i], 0, 0);
          ctx.restore();
          */

          for (let i = 0; i < text.length; i++) {
          const angle = startAngle - i * anglePerChar + parseFloat(wordShiftInput.value);
          ctx.save();
          ctx.rotate(angle);
          ctx.translate(0, -textRadius);
          ctx.rotate(Math.PI / 1); // Rotate each character to face outward

          ctx.fillText(text[i], 0, 0);
          ctx.restore();
        }
        ctx.restore();

        // Show preview of the image
        // profilePreview.src = canvas.toDataURL("image/png");
        // profilePreview.style.display = "block";
        
        // Show preview of the image
        if (image) {
          profilePreview.src = canvas.toDataURL("image/png");
        } else {
          profilePreview.src = defaultImage.src;
          
        }
        profilePreview.style.display = "block";

        // Enable download button
        downloadBtn.disabled = false;
        downloadBtn.classList.remove('bg-gray-500', 'hover:bg-gray-700', 'cursor-not-allowed');
        downloadBtn.classList.add('bg-green-500', 'hover:bg-green-700');
      }

      downloadBtn.addEventListener("click", function () {
        // Trigger download
        const link = document.createElement("a");
        link.href = canvas.toDataURL("image/png");
        link.download = "profile-image.png";
        link.click();
      })

      function hexToRgb(hex) {
        var result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
        return result ? {
          r: parseInt(result[1], 16),
          g: parseInt(result[2], 16),
          b: parseInt(result[3], 16)
        } : null;
      }
      
      const colorInput = document.getElementById('arc-color');
      const colorCodeSpan = document.getElementById('color-code');
      // const colorSwatchSpan = document.getElementById('color-swatch');

      colorInput.addEventListener('input', () => {
        colorCodeSpan.textContent = colorInput.value;
        // colorSwatchSpan.style.backgroundColor = colorInput.value;
      });

      // Initialize the color code span and color swatch span with the initial value
      colorCodeSpan.textContent = colorInput.value;
      // colorSwatchSpan.style.backgroundColor = colorInput.value;
      
      const colorInputText = document.getElementById('text-color');
      const colorCodeSpanText = document.getElementById('text-color-code');

      colorInputText.addEventListener('input', () => {
      colorCodeSpanText.textContent = colorInputText.value;
      });

      // Initialize the color code span and color swatch span with the initial value
      colorCodeSpanText.textContent = colorInputText.value;
      
    </script>
  </body>
</html>
