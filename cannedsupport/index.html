<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <title>Canned Support App</title>

  <!-- Primary Meta Tags -->
  <meta name="title" content="Canned Support App" />
  <meta name="description" content="Canned Support App ‚Äì A tool for customer support professionals to quickly preset and copy canned messages. Made by Jason Leow @jasonleowsg" />

  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://jasonleow.com/cannedsupport/" />
  <meta property="og:title" content="Canned Support App" />
  <meta property="og:description" content="Canned Support App ‚Äì A tool for customer support professionals to quickly preset and copy canned messages. Made by Jason Leow @jasonleowsg" />
  <meta property="og:image" content="/cannedsupport/cannedsupport-ogimage.png" />

  <!-- Twitter -->
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://jasonleow.com/cannedsupport/" />
  <meta property="twitter:title" content="Canned Support App" />
  <meta property="twitter:description" content="Canned Support App ‚Äì A tool for customer support professionals to quickly preset and copy canned messages. Made by Jason Leow @jasonleowsg" />
  <meta property="twitter:image" content="/cannedsupport/cannedsupport-ogimage.png" />

  <link rel="canonical" href="https://jasonleow.com/cannedsupport/">

  <!-- Mobile app icon -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Canned Support App" />
  <meta name="mobile-web-app-capable" content="yes" />
  <link rel="apple-touch-icon" sizes="180x180" href="/cannedsupport/cannedsupport-thumbnail.png" />

  <!-- Favicon -->
  <link rel="icon" type="image/png" sizes="32x32" href="/cannedsupport/cannedsupport-favicon.png" />
  <link rel="icon" type="image/png" sizes="16x16" href="/cannedsupport/cannedsupport-favicon.png" />

  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
    }
  </script>
</head>

<body class="bg-gray-100 dark:bg-gray-900 min-h-screen">

  <!-- Onboarding Modal -->
  <div id="onboardingModal" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full relative">
      <button id="closeOnboardingModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">Welcome to Canned Support App</h2>
      <p class="text-gray-600 dark:text-gray-300 mb-4">
        This app helps you manage and use canned responses for customer support. Click on a button to copy its text to your clipboard. Use the search bar to find specific responses quickly.
      </p>
      <p class="text-gray-600 dark:text-gray-300 mb-4">
        You can add custom buttons and categories to tailor the app to your needs. Happy supporting!
      </p>
      <hr class="border my-6">
      <p class="text-gray-600 dark:text-gray-300 font-bold mb-3">
        üîë Hot key shortcuts:
      </p>
      <ul class="space-y-2">
        <li class="flex items-center">
          <span class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 text-xs font-mono px-2 py-1 rounded mr-2">Esc</span>
          <span class="text-gray-600 dark:text-gray-300">Clear search input</span>
        </li>
        <li class="flex items-center">
          <span class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 text-xs font-mono px-2 py-1 rounded mr-2">Shift + Esc</span>
          <span class="text-gray-600 dark:text-gray-300">Set search input into focus</span>
        </li>
      </ul>
      <hr class="border my-6">
      <p class="text-gray-600 dark:text-gray-300 font-bold">
        ‚ö†Ô∏è Note: The data you add is saved locally to your browser, and gets deleted when you clear the browser cache. So clear cache with care!
      </p>
    </div>
  </div>
  
  <!-- Hot keys Modal -->
  <div id="hotKeysModal" class="hidden fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
    <div class="bg-white dark:bg-gray-800 rounded-lg shadow-xl p-6 max-w-md w-full relative">
      <button id="closeHotKeysModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
      <h2 class="text-2xl font-bold mb-4 text-gray-800 dark:text-gray-200">üîë Hot key shortcuts:</h2>
      <ul class="space-y-2">
        <li class="flex items-center">
          <span class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 text-xs font-mono px-2 py-1 rounded mr-2">Esc</span>
          <span class="text-gray-600 dark:text-gray-300">Clear search input</span>
        </li>
        <li class="flex items-center">
          <span class="bg-gray-200 dark:bg-gray-600 text-gray-700 dark:text-gray-200 text-xs font-mono px-2 py-1 rounded mr-2">Shift + Esc</span>
          <span class="text-gray-600 dark:text-gray-300">Set search input into focus</span>
        </li>
      </ul>
    </div>
  </div>

  <div class="container md:w-7xl md:max-w-full md:mx-auto p-10 flex justify-center">
    <div class="">
      <div class="flex items-center justify-between mx-auto w-[60rem] max-w-[60rem]">
        <div class="flex items-center justify-start">
          <!-- <img src="/cannedsupport-transparentbg.png" class="h-12 w-12 -mt-5 mr-3" /> -->
          <img src="https://em-content.zobj.net/source/apple/391/canned-food_1f96b.png" class="h-12 w-12 -mt-5 mr-3" />
          <div>
            <div class="flex items-center">
              <h1 class="text-3xl font-bold mb-1 text-gray-800 dark:text-gray-50">Canned Support App</h1>
              <button id="onboardingInfoButton" class="ml-2 text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
              </button>
            </div>
            <p class="text-sm dark:text-white mb-6">A tool for customer support professionals to quickly preset and copy canned messages.</p>
          </div>
        </div>
        <div class="flex items-center space-x-2">
          <button id="hotKeys" onclick="openHotKeysModal()" title="Show hot keys" class="mb-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-300">
            üîë
          </button>
          <button id="darkModeToggle" title="Toggle dark mode" class="mb-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-300">
            üåó
          </button>
          <button id="downloadJSON" title="Download a copy of all your canned replies in .JSON file format" class="mb-4 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-gray-200 px-4 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition duration-300">
            üì•
          </button>
        </div>
      </div>

      <div class="flex justify-center sticky z-10 top-0">
        <!-- Preview Window -->
        <div id="previewContainer" class="w-[60rem] max-w-[60rem] mb-4 bg-gray-100 dark:bg-gray-900">
          <div class="relative">
            <div class="w-fit absolute top-2 left-4 mb-3 text-xs rounded text-gray-200 bg-fuchsia-800 bg-opacity-100 px-2 py-1">Preview</div>
            <div id="preview" class="bg-white dark:bg-gray-800 pt-10 pb-4 px-4 rounded-lg shadow-md mb-2 h-48 min-h-48 max-h-[70%] resize-y overflow-y-auto dark:text-gray-200"></div>
          </div>

          <!-- Search Input -->
          <div class="">
            <div class="relative">
              <input id="searchInput" type="text" placeholder="Search for text content in buttons..." class="w-full p-2 pl-10 pr-4 rounded-lg border border-gray-300 dark:border-gray-600 bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500 dark:focus:ring-teal-500 focus:border-transparent">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <svg class="h-5 w-5 text-gray-400" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
                </svg>
              </div>
              <button id="clearButton" class="absolute inset-y-0 right-0 pr-3 flex items-center text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
                <svg class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
                  <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                </svg>
              </button>
            </div>
          </div>

        </div>
      </div>

      <!-- Custom Button Modal -->
      <div id="customBtnModal" class="fixed z-10 inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg">
          <h2 class="text-xl dark:text-white font-bold mb-2">Add Custom Button</h2>
          <p class="text-sm dark:text-white mb-6">For now, this is saved locally in your browser.</p>
          <input id="customBtnTitle" type="text" placeholder="Button Title" class="w-full mb-2 p-2 border rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:ring-teal-500 dark:focus:ring-teal-500 focus:border-teal-500 dark:focus:border-teal-500">
          <textarea id="customBtnText" placeholder="Button Text" class="w-full mb-4 p-2 border rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:ring-teal-500 dark:focus:ring-teal-500 focus:border-teal-500 dark:focus:border-teal-500" rows="4"></textarea>
          <div class="flex justify-between">
            <button id="deleteCustomBtn" class="bg-red-500 text-white px-4 py-2 rounded mr-2 hover:bg-red-600 transition duration-300 hidden">Delete</button>
            <div class="flex">
              <button id="cancelCustomBtn" class="bg-gray-300 text-gray-800 px-4 py-2 rounded mr-2 hover:bg-gray-400 transition duration-300">Cancel</button>
              <button id="saveCustomBtn" class="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600 transition duration-300">Save</button>
            </div>
          </div>
        </div>
      </div>

      <div class="resize overflow-auto min-h-[20rem] min-w-[62rem] max-w-full px-5">  
        <!-- Content -->
        <div id="allContent" class="mb-4"></div>

        <!-- Add Category Button -->
        <button id="addCategoryBtn" class="bg-teal-500 bg-opacity-50 border border-teal-500 dark:text-white text-gray-600 text-xs py-1.5 px-2 rounded inline-flex items-center justify-between mr-2 mb-2 hover:bg-teal-600 hover:bg-opacity-20 transition duration-300">
          <span class="flex items-center justify-center w-4 h-4 mr-2 bg-gray-200 rounded-full cursor-pointer hover:bg-green-400">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 hover:text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
            </svg>
          </span>
          Add Category
        </button>
      </div>

      <!-- Add Category Modal -->
      <div id="addCategoryModal" class="fixed z-10 inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center">
        <div class="bg-white dark:bg-gray-900 p-6 rounded-lg shadow-lg">
          <h2 class="text-xl dark:text-white font-bold mb-2">Add New Category</h2>
          <input id="newCategoryName" type="text" placeholder="Category Name" class="w-full mb-4 p-2 border rounded bg-white dark:bg-gray-700 text-gray-800 dark:text-gray-200 border-gray-300 dark:border-gray-600 focus:ring-teal-500 dark:focus:ring-teal-500 focus:border-teal-500 dark:focus:border-teal-500">
          <div class="flex justify-between">
            <button id="deleteCategoryBtn" class="bg-red-500 text-white px-4 py-2 rounded mr-2 hover:bg-red-600 transition duration-300 hidden">Delete</button>
            <div class="flex">
              <button id="cancelAddCategory" class="bg-gray-300 text-gray-800 px-4 py-2 rounded mr-2 hover:bg-gray-400 transition duration-300">Cancel</button>
              <button id="saveNewCategory" class="bg-teal-500 text-white px-4 py-2 rounded hover:bg-teal-600 transition duration-300">Save</button>
            </div>
          </div>
        </div>
      </div>

    </div>
  </div>

  <script>
    let categories = ['Category 01'];
    let buttons = {
      Category 01: [{
          title: 'Reply 01',
          isFAQ: true,
          text: 'This is the canned reply for Category 01, and set as an FAQ.\nIt can have multiple lines.',
        },
        {
          title: 'Reply 02',
          isFAQ: false,
          text: 'This is the canned reply for Category 01.\nAnother line here.',
        },
        // Add more predefined buttons for the FAQs category
      ],
    };
    const preview = document.getElementById('preview');
    const allContent = document.getElementById('allContent');
    const customBtnModal = document.getElementById('customBtnModal');
    const customBtnTitle = document.getElementById('customBtnTitle');
    const customBtnText = document.getElementById('customBtnText');
    const cancelCustomBtn = document.getElementById('cancelCustomBtn');
    const saveCustomBtn = document.getElementById('saveCustomBtn');

    function createButton(title, text, category, isCustom = false, isSample = false) {
      const button = document.createElement('button');
      button.className = 'bg-transparent border border-teal-500 text-xs dark:text-white text-gray-600 py-1.5 pl-2.5 pr-1 rounded inline-flex items-center justify-center min-w-[5rem] mr-2 mb-2 hover:bg-teal-600 hover:bg-opacity-20 transition duration-300';
      let buttonContent = `<span>${title}</span>`;
      // Add edit button for all buttons
      buttonContent += `<span class="edit-btn flex items-center justify-center w-4 h-4 ml-1 text-gray-600 cursor-pointer hover:text-blue-400">
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4 p-0 cursor-pointer hover:text-blue-400">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
        </svg>
      </span>`;
      button.innerHTML = buttonContent;
      button.addEventListener('click', (e) => {
        if (!e.target.closest('.edit-btn')) {
          copyToClipboard(text, button);
        }
      });
      button.addEventListener('mouseover', () => showPreview(text));
      button.addEventListener('mouseout', () => clearPreview());
      // Add edit functionality
      const editBtn = button.querySelector('.edit-btn');
      editBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        editButton(category, title, text, isSample);
      });
      return button;
    }

    function deleteButton(button, category, title) {
      if (confirm('Are you sure you want to delete this button?')) {
        // Find the button in the array
        const buttonIndex = buttons[category].findIndex(btn => btn.title === title);
        if (buttonIndex !== -1) {
          const isSample = buttons[category][buttonIndex].isSample;
          // If it's a sample button, mark it as deleted in localStorage
          if (isSample) {
            // Get or initialize the deleted sample buttons array
            let deletedSampleButtons = JSON.parse(localStorage.getItem('deletedSampleButtons') || '[]');
            // Add this button's identifier to the deleted list
            deletedSampleButtons.push({
              category,
              title
            });
            localStorage.setItem('deletedSampleButtons', JSON.stringify(deletedSampleButtons));
          }
          // Remove the button from the current array
          buttons[category].splice(buttonIndex, 1);
          saveToLocalStorage();
          renderAllContent();
        }
      }
    }

    function editButton(category, title, text, isSample = false) {
      // Set the modal title
      const modalTitle = customBtnModal.querySelector('h2');
      modalTitle.textContent = 'Edit the button';
      // Set the form values
      customBtnTitle.value = title;
      customBtnText.value = text;
      // Set the editing state
      customBtnModal.dataset.isEditing = 'true';
      customBtnModal.dataset.originalTitle = title;
      customBtnModal.dataset.category = category;
      customBtnModal.dataset.isSample = isSample.toString();
      // Show the delete button
      document.getElementById('deleteCustomBtn').classList.remove('hidden');
      // Show the modal
      customBtnModal.classList.remove('hidden');
      customBtnModal.classList.add('flex');
    }

    function editCategory(category) {
      // Set the modal title
      const modalTitle = addCategoryModal.querySelector('h2');
      modalTitle.textContent = 'Edit category';
      // Set the form values
      newCategoryName.value = category;
      // Set the editing state
      addCategoryModal.dataset.isEditing = 'true';
      addCategoryModal.dataset.originalCategory = category;
      // Show the delete button
      document.getElementById('deleteCategoryBtn').classList.remove('hidden');
      // Show the modal
      addCategoryModal.classList.remove('hidden');
      addCategoryModal.classList.add('flex');
    }

    function renderAllContent() {
      allContent.innerHTML = '';
    
      // 1. Construct the FAQs buttons list dynamically (as the very first section)
      const allFAQButtons = [];
      for (const [cat, btnArr] of Object.entries(buttons)) {
        for (const btn of btnArr) {
          if (btn.isFAQ) {
            // You can still edit or delete the button in its real category, so we need category info!
            allFAQButtons.push({ ...btn, category: cat });
          }
        }
      }
      if (allFAQButtons.length > 0) {
        // Create the FAQs section (cannot be edited/deleted)
        const faqsContainer = document.createElement('div');
        faqsContainer.className = 'mb-5';
        const faqsTitleContainer = document.createElement('div');
        faqsTitleContainer.className = 'flex items-center mb-1';
        const faqsTitle = document.createElement('h2');
        faqsTitle.className = 'w-fit text-xs rounded text-white bg-gray-400 bg-opacity-100 px-2 py-1';
        faqsTitle.textContent = 'FAQs';
        faqsTitleContainer.appendChild(faqsTitle);
        faqsContainer.appendChild(faqsTitleContainer);
    
        const buttonWrapper = document.createElement('div');
        buttonWrapper.className = 'flex flex-wrap items-center bg-white dark:bg-gray-800 pt-3 px-3 rounded-lg shadow-md';
        allFAQButtons.forEach(btn => {
          // Note: pass true as isSample if you want to mark FAQ buttons
          buttonWrapper.appendChild(
            createButton(btn.title, btn.text, btn.category, btn.isCustom, btn.isSample)
          );
        });
        faqsContainer.appendChild(buttonWrapper);
        allContent.appendChild(faqsContainer);
      }
    
      // 2. Now loop through the rest of your real (non-faqs) categories and display as usual!
      categories.forEach(category => {
        // (Don't create a FAQs duplicate)
        //if (category === 'FAQs') return;
    
        if (!buttons[category]) {
          buttons[category] = [];
        }
        const categoryContainer = document.createElement('div');
        categoryContainer.className = 'mb-5';
        const categoryTitleContainer = document.createElement('div');
        categoryTitleContainer.className = 'flex items-center mb-1';
        const categoryTitle = document.createElement('h2');
        categoryTitle.className = 'w-fit text-xs rounded text-white bg-gray-400 bg-opacity-100 px-2 py-1';
        categoryTitle.textContent = category.charAt(0).toUpperCase() + category.slice(1);
        categoryTitleContainer.appendChild(categoryTitle);
        // Add edit button for all categories
        categoryTitleContainer.appendChild(createEditCategoryButton(category));
        categoryContainer.appendChild(categoryTitleContainer);
    
        const buttonWrapper = document.createElement('div');
        buttonWrapper.className = 'flex flex-wrap items-center bg-white dark:bg-gray-800 pt-3 px-3 rounded-lg shadow-md';
        buttonWrapper.appendChild(createAddCustomButton(category));
        buttons[category].forEach(btn => {
          buttonWrapper.appendChild(
            createButton(btn.title, btn.text, category, btn.isCustom, btn.isSample)
          );
        });
        categoryContainer.appendChild(buttonWrapper);
        allContent.appendChild(categoryContainer);
      });
    }

    function createEditCategoryButton(category) {
      const editBtn = document.createElement('button');
      editBtn.className = 'ml-1 flex items-center justify-center w-4 h-4 text-gray-600 cursor-pointer hover:text-blue-400';
      editBtn.innerHTML = `
        <svg xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 24 24" stroke-width="2.5" stroke="currentColor" class="w-4 h-4">
          <path stroke-linecap="round" stroke-linejoin="round" d="M12 6.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 12.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5ZM12 18.75a.75.75 0 1 1 0-1.5.75.75 0 0 1 0 1.5Z" />
        </svg>
      `;
      editBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        editCategory(category);
      });
      return editBtn;
    }

    function createDeleteCategoryButton(category) {
      const deleteBtn = document.createElement('button');
      deleteBtn.className = 'ml-2 flex items-center justify-center w-4 h-4 bg-gray-200 text-gray-600 rounded-full cursor-pointer hover:bg-red-400 hover:text-white';
      deleteBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6" transform="rotate(45 12 12)"></path></svg>';
      deleteBtn.addEventListener('click', (e) => {
        e.stopPropagation();
        deleteCategory(category);
      });
      return deleteBtn;
    }

    function deleteCategory(category) {
      if (confirm(`Are you sure you want to delete the category "${category}" and all its buttons?`)) {
        // If it's the FAQs category, mark it as deleted in localStorage
        if (category === 'FAQs') {
          localStorage.setItem('faqsCategoryDeleted', 'true');
        }
        // Remove the category from the current arrays
        categories = categories.filter(cat => cat !== category);
        delete buttons[category];
        saveToLocalStorage();
        renderAllContent();
        closeAddCategoryModal();
      }
    }

    function createAddCustomButton(category) {
      const addCustomBtnClone = document.createElement('button');
      addCustomBtnClone.className = 'bg-teal-500 bg-opacity-50 border border-teal-500 dark:text-white text-xs text-gray-600 py-1.5 pl-2 pr-2.5 rounded inline-flex items-center justify-between mr-2 mb-2 hover:bg-teal-600 hover:bg-opacity-20 transition duration-300';
      addCustomBtnClone.innerHTML = `
        <span class="flex items-center justify-center w-4 h-4 mr-2 bg-gray-200 rounded-full cursor-pointer hover:bg-green-400">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 text-gray-500 hover:text-white" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6m0 0v6m0-6h6m-6 0H6"></path>
          </svg>
        </span>
        Add
      `;
      addCustomBtnClone.addEventListener('click', () => {
        customBtnModal.classList.remove('hidden');
        customBtnModal.classList.add('flex');
        customBtnModal.dataset.category = category;
      });
      return addCustomBtnClone;
    }

    function showPreview(text) {
      preview.innerHTML = text.replace(/\n/g, '<br>');
    }

    function clearPreview() {
      preview.innerHTML = '';
    }

    function copyToClipboard(text, button) {
      navigator.clipboard.writeText(text).then(() => {
        const originalContent = button.innerHTML;
        const originalClasses = button.className;
        // Store the original width
        const originalWidth = button.offsetWidth;
        // Update button content and classes
        button.innerHTML = '<span class="flex items-center justify-center w-full">Copied ‚úì</span>';
        button.className = 'bg-teal-500 border border-teal-500 text-white text-xs py-1.5 px-2 rounded inline-flex items-center justify-center mr-2 mb-2 transition duration-300';
        // Set the button width to match the original width
        button.style.width = `${originalWidth}px`;
        setTimeout(() => {
          button.innerHTML = originalContent;
          button.className = originalClasses;
          button.style.width = ''; // Remove the inline width
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy text: ', err);
        alert('Failed to copy text. Please try again.');
      });
    }

    function saveToLocalStorage() {
      localStorage.setItem('customButtons', JSON.stringify(buttons));
      localStorage.setItem('categories', JSON.stringify(categories));
    }

    function loadFromLocalStorage() {
      try {
        const savedButtons = localStorage.getItem('customButtons');
        const savedCategories = localStorage.getItem('categories');
        const faqsCategoryDeleted = localStorage.getItem('faqsCategoryDeleted') === 'true';
        const deletedSampleButtons = JSON.parse(localStorage.getItem('deletedSampleButtons') || '[]');
        // Load saved categories
        if (savedCategories) {
          categories = JSON.parse(savedCategories);
        }
        // If FAQs category was deleted, remove it from the categories array
        if (faqsCategoryDeleted && categories.includes('FAQs')) {
          categories = categories.filter(cat => cat !== 'FAQs');
        }
        // Load saved buttons
        if (savedButtons) {
          const parsedButtons = JSON.parse(savedButtons);
          for (const category in parsedButtons) {
            buttons[category] = parsedButtons[category].map(btn => ({
              ...btn,
              isCustom: btn.isCustom || false,
              isSample: btn.isSample || false
            }));
          }
        }
        // Make sure all categories have a corresponding buttons array
        categories.forEach(category => {
          if (!buttons[category]) {
            buttons[category] = [];
          }
        });
        // Remove sample buttons that were marked as deleted
        if (deletedSampleButtons.length > 0 && buttons.FAQs) {
          deletedSampleButtons.forEach(item => {
            if (buttons[item.category]) {
              buttons[item.category] = buttons[item.category].filter(btn =>
                !(btn.title === item.title && btn.isSample)
              );
            }
          });
        }
        console.log('After loading from localStorage:');
        console.log('Categories:', categories);
        console.log('Buttons:', buttons);
      } catch (error) {
        console.error('Error loading data from localStorage:', error);
        // Continue with default values if there's an error
      }
    }

    function closeModal() {
      // Reset the editing state
      customBtnModal.dataset.isEditing = 'false';
      customBtnModal.dataset.originalTitle = '';
      customBtnModal.dataset.isSample = 'false';
      // Reset the modal title
      const modalTitle = customBtnModal.querySelector('h2');
      modalTitle.textContent = 'Add Custom Button';
      // Hide the delete button
      document.getElementById('deleteCustomBtn').classList.add('hidden');
      // Hide the modal
      customBtnModal.classList.add('hidden');
      customBtnModal.classList.remove('flex');
      customBtnTitle.value = '';
      customBtnText.value = '';
    }
    customBtnModal.addEventListener('click', (e) => {
      if (e.target === customBtnModal) {
        closeModal();
      }
    });
    cancelCustomBtn.addEventListener('click', closeModal);
    saveCustomBtn.addEventListener('click', saveCustomButton);
    // Add Category functionality
    const addCategoryBtn = document.getElementById('addCategoryBtn');
    const addCategoryModal = document.getElementById('addCategoryModal');
    const newCategoryName = document.getElementById('newCategoryName');
    const cancelAddCategory = document.getElementById('cancelAddCategory');
    const saveNewCategory = document.getElementById('saveNewCategory');
    addCategoryBtn.addEventListener('click', function() {
      addCategoryModal.classList.remove('hidden');
      addCategoryModal.classList.add('flex');
      addCategoryModal.dataset.isEditing = 'false';
      addCategoryModal.dataset.originalCategory = '';
      // Reset the modal title
      const modalTitle = addCategoryModal.querySelector('h2');
      modalTitle.textContent = 'Add New Category';
      // Hide the delete button
      document.getElementById('deleteCategoryBtn').classList.add('hidden');
    });

    function closeAddCategoryModal() {
      // Reset the editing state
      addCategoryModal.dataset.isEditing = 'false';
      addCategoryModal.dataset.originalCategory = '';
      // Reset the modal title
      const modalTitle = addCategoryModal.querySelector('h2');
      modalTitle.textContent = 'Add New Category';
      // Hide the delete button
      document.getElementById('deleteCategoryBtn').classList.add('hidden');
      // Hide the modal
      addCategoryModal.classList.add('hidden');
      addCategoryModal.classList.remove('flex');
      newCategoryName.value = '';
    }
    addCategoryModal.addEventListener('click', (e) => {
      if (e.target === addCategoryModal) {
        closeAddCategoryModal();
      }
    });
    cancelAddCategory.addEventListener('click', closeAddCategoryModal);
    saveNewCategory.addEventListener('click', saveCategory);
    // Initialize
    loadFromLocalStorage();
    renderAllContent();
    // Dark mode toggle
    const darkModeToggle = document.getElementById('darkModeToggle');
    const html = document.documentElement;
    darkModeToggle.addEventListener('click', () => {
      html.classList.toggle('dark');
      localStorage.setItem('darkMode', html.classList.contains('dark'));
    });
    // Check for saved dark mode preference
    if (localStorage.getItem('darkMode') === 'true') {
      html.classList.add('dark');
    }
    // ------------------------------------------------------------- //
    // ------------------------- SEARCH ---------------------------- //
    // ------------------------------------------------------------- //
    function searchButtons(query) {
      const lowercaseQuery = query.toLowerCase().trim();
      // Reset all buttons to their original state
      document.querySelectorAll('.search-highlight').forEach(el => {
        el.classList.remove('search-highlight', 'bg-yellow-200', 'hover:bg-opacity-70', 'dark:bg-yellow-300', 'dark:text-gray-800', 'dark:hover:bg-opacity-70');
        el.classList.add('hover:bg-teal-600', 'hover:bg-opacity-20');
      });
      if (lowercaseQuery === '') return; // If query is empty, just reset and return
      categories.forEach(category => {
        buttons[category].forEach(button => {
          const titleMatch = button.title.toLowerCase().includes(lowercaseQuery);
          const textMatch = button.text.toLowerCase().includes(lowercaseQuery);
          if (titleMatch || textMatch) {
            highlightButton(button.title);
          }
        });
      });
    }

    function highlightButton(title) {
      const buttons = document.querySelectorAll('button');
      for (const button of buttons) {
        if (button.textContent.includes(title)) {
          button.classList.remove('hover:bg-teal-600', 'hover:bg-opacity-20');
          button.classList.add('search-highlight', 'bg-yellow-200', 'hover:bg-opacity-70', 'dark:bg-yellow-300', 'dark:text-gray-800', 'dark:hover:bg-opacity-70');
          break; // Stop after finding the first match
        }
      }
    }
    // Add event listener to the existing search input
    document.getElementById('searchInput').addEventListener('input', (e) => searchButtons(e.target.value));
    // ------------------------------------------------------------- //
    // ------------------------- MODAL ----------------------------- //
    // ------------------------------------------------------------- //
    // Modal functionality
    const onboardingModal = document.getElementById('onboardingModal');
    const closeOnboardingModal = document.getElementById('closeOnboardingModal');
    const onboardingInfoButton = document.getElementById('onboardingInfoButton');

    function showOnboardingModal() {
      onboardingModal.classList.remove('hidden');
    }

    function hideOnboardingModal() {
      onboardingModal.classList.add('hidden');
    }
    // Show modal on page load
    window.addEventListener('load', showOnboardingModal);
    // Close modal when clicking the close button
    closeOnboardingModal.addEventListener('click', hideOnboardingModal);
    // Close modal when clicking outside of it
    onboardingModal.addEventListener('click', (e) => {
      if (e.target === onboardingModal) {
        hideOnboardingModal();
      }
    });
    // Show modal when clicking the info button
    onboardingInfoButton.addEventListener('click', showOnboardingModal);
    // Close modal with Escape key
    document.addEventListener('keydown', (e) => {
      if (e.key === 'Escape' && !onboardingModal.classList.contains('hidden')) {
        hideOnboardingModal();
      }
    });
    // -------------------------------------------------------------------- //
    // ------------------------- DOWNLOAD BTN ---------------------------- //
    // ------------------------------------------------------------------ //
    // Download JSON functionality
    function downloadJSON() {
      const data = {
        categories: categories,
        buttons: buttons
      };
      const jsonString = JSON.stringify(data, null, 2);
      const blob = new Blob([jsonString], {
        type: 'application/json'
      });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'canned_replies.json';
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
    }
    // Add event listener to the download button
    document.getElementById('downloadJSON').addEventListener('click', downloadJSON);
    // Add event listeners for the delete buttons
    document.getElementById('deleteCustomBtn').addEventListener('click', function() {
      const category = customBtnModal.dataset.category;
      const title = customBtnModal.dataset.originalTitle;
      const isSample = customBtnModal.dataset.isSample === 'true';
      if (confirm(`Are you sure you want to delete the button "${title}"?`)) {
        // Find the button in the array
        const buttonIndex = buttons[category].findIndex(btn => btn.title === title);
        if (buttonIndex !== -1) {
          // If it's a sample button, mark it as deleted in localStorage
          if (isSample) {
            // Get or initialize the deleted sample buttons array
            let deletedSampleButtons = JSON.parse(localStorage.getItem('deletedSampleButtons') || '[]');
            // Add this button's identifier to the deleted list
            deletedSampleButtons.push({
              category,
              title
            });
            localStorage.setItem('deletedSampleButtons', JSON.stringify(deletedSampleButtons));
          }
          // Remove the button from the current array
          buttons[category].splice(buttonIndex, 1);
          saveToLocalStorage();
          renderAllContent();
          closeModal();
        }
      }
    });
    document.getElementById('deleteCategoryBtn').addEventListener('click', function() {
      const category = addCategoryModal.dataset.originalCategory;
      if (confirm(`Are you sure you want to delete the category "${category}" and all its buttons?`)) {
        // If it's the FAQs category, mark it as deleted in localStorage
        if (category === 'FAQs') {
          localStorage.setItem('faqsCategoryDeleted', 'true');
        }
        // Remove the category from the current arrays
        categories = categories.filter(cat => cat !== category);
        delete buttons[category];
        saveToLocalStorage();
        renderAllContent();
        closeAddCategoryModal();
      }
    });

    function saveCategory() {
      const newCategory = newCategoryName.value.trim();
      if (!newCategory) {
        alert('Please enter a category name.');
        return;
      }
      const isEditing = addCategoryModal.dataset.isEditing === 'true';
      const originalCategory = addCategoryModal.dataset.originalCategory;
      if (isEditing) {
        // Update existing category
        if (newCategory !== originalCategory) {
          // Rename the category in the categories array
          const categoryIndex = categories.indexOf(originalCategory);
          if (categoryIndex !== -1) {
            categories[categoryIndex] = newCategory;
          }
          // Move buttons to the new category name
          buttons[newCategory] = buttons[originalCategory] || [];
          delete buttons[originalCategory];
        }
      } else {
        // Add new category
        if (!categories.includes(newCategory)) {
          categories.push(newCategory);
          buttons[newCategory] = [];
        } else {
          alert('This category already exists.');
          return;
        }
      }
      saveToLocalStorage();
      renderAllContent();
      closeAddCategoryModal();
    }

    function saveCustomButton() {
      const title = customBtnTitle.value.trim();
      const text = customBtnText.value.trim();
      const category = customBtnModal.dataset.category || currentCategory;
      if (!title || !text) {
        alert('Please fill in both title and text fields.');
        return;
      }
      const isEditing = customBtnModal.dataset.isEditing === 'true';
      const originalTitle = customBtnModal.dataset.originalTitle;
      const isSample = customBtnModal.dataset.isSample === 'true';
      // Initialize the category array if it doesn't exist
      if (!buttons[category]) {
        buttons[category] = [];
      }
      if (isEditing) {
        // Find the button in the array
        const buttonIndex = buttons[category].findIndex(btn => btn.title === originalTitle);
        if (buttonIndex !== -1) {
          // Update the existing button
          buttons[category][buttonIndex].title = title;
          buttons[category][buttonIndex].text = text;
        }
      } else {
        // Add a new button
        buttons[category].push({
          title: title,
          text: text,
          isSample: false
        });
      }
      saveToLocalStorage();
      renderAllContent();
      closeModal();
    }
    // ------------------------------------------------------------------------ //
    // ------------------------- CLEAR SEARCH BAR ---------------------------- //
    // ---------------------------------------------------------------------- //
    // Get references to the input and button elements
    const searchInput = document.getElementById('searchInput');
    const clearButton = document.getElementById('clearButton');

    // Add click event listener to the button
    clearButton.addEventListener('click', function() {
      // Clear the input value
      searchInput.value = '';
      searchButtons("");
      // Optionally, you can trigger any search update or other actions here
      // For example: triggerSearch();
    });
    
    // ------------------------------------------------------ //
    // ---------- HOT KEYS TO CLEAR OR FOCUS SEARCH BAR ---- //
    // ---------------------------------------------------- //
    document.addEventListener('keydown', handleKeyPress);

    function handleKeyPress(event) {
      if (event.key === 'Escape') {
        clearSearch();
      }
    }

    function clearSearch() {
      const searchInput = document.getElementById('searchInput');
      searchInput.value = '';
      searchButtons("");
    }

    // Add keyboard shortcut to focus search
    document.addEventListener('keydown', function(event) {
      // Check if it's Shift+Escape
      if (event.shiftKey && event.key === 'Escape') {
        // Prevent the default browser behavior
        event.preventDefault();
        
        // Focus the search input
        const searchInput = document.getElementById('searchInput');
        searchInput.focus();
      }
    });

    // Auto focus search input when switch back to window/tab
    document.addEventListener('visibilitychange', function() {
      if (document.visibilityState === 'visible') {
        const searchInput = document.getElementById('searchInput');
        searchInput.focus();
      }
    });
    
    // ------------------------------------------------------ //
    // ---------- HOT KEYS MODAL ---- //
    // ---------------------------------------------------- //
    // Global variable to store the outside click event listener
    let outsideClickListener;

    // Function to close the modal
    function closeHotKeysModal() {
      const modal = document.getElementById('hotKeysModal');
      modal.classList.add('hidden');
      // Remove the outside click event listener when the modal is closed
      if (outsideClickListener) {
        document.removeEventListener('click', outsideClickListener);
        outsideClickListener = null;
      }
    }

    // Function to handle outside clicks
    function handleOutsideClick(event) {
      const modalContent = document.querySelector('#hotKeysModal > div');
      if (!modalContent.contains(event.target)) {
        closeHotKeysModal();
      }
    }

    function openHotKeysModal() {
      const modal = document.getElementById('hotKeysModal');

      // Remove the 'hidden' class to show the modal
      modal.classList.remove('hidden');

      // Close modal when clicking the close button
      const closeButton = document.getElementById('closeHotKeysModal');
      closeButton.addEventListener('click', closeHotKeysModal);

      // Remove any existing outside click listener
      if (outsideClickListener) {
        document.removeEventListener('click', outsideClickListener);
      }

      // Set up the new outside click listener
      outsideClickListener = handleOutsideClick;

      // Add a slight delay before adding the click event listener
      // This prevents the modal from closing immediately when it's opened
      setTimeout(() => {
        document.addEventListener('click', outsideClickListener);
      }, 0);
    }

  </script>
</body>

</html>
