<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dead Link Checker</title>
  <meta name="title" content="Dead Link Checker" />
  <meta name="description" content="A tool to check for dead links in your website - by Jason Leow @jasonleowsg" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://jasonleow.com/deadlinkschecker" />
  <meta property="og:title" content="Dead Link Checker" />
  <meta property="og:description" content="A tool to check for dead links in your website - by Jason Leow @jasonleowsg" />
  <meta property="og:image" content="https://i.postimg.cc/VkJX8PnN/deadlinkchecker-og-image.png" />
  <meta property="twitter:card" content="summary_large_image" />
  <meta property="twitter:url" content="https://jasonleow.com/deadlinkschecker" />
  <meta property="twitter:title" content="Dead Link Checker" />
  <meta property="twitter:description" content="A tool to check for dead links in your website - by Jason Leow @jasonleowsg" />
  <meta property="twitter:image" content="https://i.postimg.cc/VkJX8PnN/deadlinkchecker-og-image.png" />
  <link rel="icon" type="image/png" sizes="32x32" href="https://i.postimg.cc/Rh4Vjpq0/favicon-32px-tagchecker.png">
  <link rel="icon" type="image/png" sizes="16x16" href="https://i.postimg.cc/Rh4Vjpq0/favicon-32px-tagchecker.png">
  <script src="https://cdn.tailwindcss.com/3.3.0"></script>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-center">
  <div class="bg-white/90 shadow-xl rounded-xl p-8 w-full max-w-2xl">
    <h1 class="text-3xl font-bold text-rose-600 mb-3 flex items-center gap-2">
      <svg class="w-8 h-8 text-rose-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path fill-rule="evenodd" clip-rule="evenodd" d="M19 21C19 21.5523 18.5523 22 18 22H14H10H6C5.44771 22 5 21.5523 5 21V18.75C5 17.7835 4.2165 17 3.25 17C2.55964 17 2 16.4404 2 15.75V11C2 5.47715 6.47715 1 12 1C17.5228 1 22 5.47715 22 11V15.75C22 16.4404 21.4404 17 20.75 17C19.7835 17 19 17.7835 19 18.75V21ZM17 20V18.75C17 16.9358 18.2883 15.4225 20 15.075V11C20 6.58172 16.4183 3 12 3C7.58172 3 4 6.58172 4 11V15.075C5.71168 15.4225 7 16.9358 7 18.75V20H9V18C9 17.4477 9.44771 17 10 17C10.5523 17 11 17.4477 11 18V20H13V18C13 17.4477 13.4477 17 14 17C14.5523 17 15 17.4477 15 18V20H17ZM11 12.5C11 13.8807 8.63228 15 7.25248 15C5.98469 15 5.99206 14.055 6.00161 12.8306V12.8305C6.00245 12.7224 6.00331 12.6121 6.00331 12.5C6.00331 11.1193 7.12186 10 8.50166 10C9.88145 10 11 11.1193 11 12.5ZM17.9984 12.8306C17.9975 12.7224 17.9967 12.6121 17.9967 12.5C17.9967 11.1193 16.8781 10 15.4983 10C14.1185 10 13 11.1193 13 12.5C13 13.8807 15.3677 15 16.7475 15C18.0153 15 18.0079 14.055 17.9984 12.8306Z" fill="currentColor"></path>
      </svg>
      Dead Link Checker
    </h1>
    <p class="mb-8 text-gray-700">
      Enter a URL to check all its links for 404/dead pages.<br>
      <span class="text-sm text-gray-500">Note: Due to browser security, this tool works best for pages that allow cross-origin access.<br>It uses a public CORS proxy; results may be slow or limited.</span>
    </p>
    <form id="mainForm" class="flex gap-3 items-center mb-4" autocomplete="off">
      <input type="url" id="url" required placeholder="https://example.com" value="https://example.com" class="flex-grow border border-gray-300 rounded-lg px-4 py-1 bg-slate-50 focus:ring-2 focus:ring-indigo-400 focus:outline-none text-lg shadow-sm">
      <button type="submit" class="bg-rose-600 text-white px-6 py-2 rounded-lg shadow-lg shadow hover:bg-rose-700 font-semibold transition">
        Check Links
      </button>
    </form>
    <div id="results" class="mt-6"></div>
  </div>
  <div class="text-center text-sm mt-20 mb-10 space-y-3">
    <div class="">A project by <a href="https://jasonleow.com" target="_blank" class="text-blue-600 hover:text-blue-800">Jason Leow</a> <a href="https://x.com/jasonleowsg" target="_blank" class="text-blue-600 hover:text-blue-800">@jasonleowsg</a></div>
    <div class="">Check your <span><a class="text-blue-600 hover:text-blue-800" href="https://jasonleow.com/alttextchecker/" target="_blank">images' alt text</a></span> too!</div>
    <div>
      <a class="text-blue-600 hover:text-blue-800" href="https://jasonleow.com">jasonleow.com |</a>
      <a class="text-blue-600 hover:text-blue-800" href="https://plugins.carrd.co">plugins.carrd.co |</a>
      <a class="text-blue-600 hover:text-blue-800" href="https://commit365.dev">commit365.dev |</a>
      <a class="text-blue-600 hover:text-blue-800" href="https://listskit.com">listskit.com |</a>
      <a class="text-blue-600 hover:text-blue-800" href="https://golifelog.com">golifelog.com</a>
    </div>
  </div>
  <script>
    const corsProxy = "https://corsproxy.io/?";

    function getStatusBadge(status) {
      if (status.includes("OK")) {
        return `<span class="inline-block bg-green-100 text-green-700 px-2 py-0.5 rounded text-xs font-bold">${status}</span>`;
      }
      if (status.includes("404") || status.includes('dead') || status === "Request Failed") {
        return `<span class="inline-block bg-red-100 text-red-700 px-2 py-0.5 rounded text-xs font-bold">${status}</span>`;
      }
      if (status.includes("error") || status.includes("403")) {
        return `<span class="inline-block bg-yellow-100 text-yellow-700 px-2 py-0.5 rounded text-xs font-bold">${status}</span>`;
      }
      return `<span class="inline-block bg-gray-200 text-gray-700 px-2 py-0.5 rounded text-xs">${status}</span>`;
    }

    document.getElementById('mainForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const url = document.getElementById('url').value.trim();

      // Show spinner (and remove everything else in #results)
      document.getElementById('results').innerHTML = `
        <div id="spinner" class="flex flex-col items-center gap-4 mt-4">
          <svg class="animate-spin h-8 w-8 text-rose-600 dark:text-rose-300" viewBox="0 0 50 50">
            <circle class="opacity-20" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="6"/>
            <circle class="opacity-100" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="6"
              stroke-linecap="round" stroke-dasharray="60, 200"
              stroke-dashoffset="0"></circle>
          </svg>
          <span class="text-gray-500">Fetching page...</span>
        </div>`;

      let html;
      try {
        const res = await fetch(corsProxy + encodeURIComponent(url));
        if (!res.ok) throw new Error("Error fetching page: " + res.status);
        html = await res.text();
      } catch (err) {
        document.getElementById('results').innerHTML = `<div class="bg-red-100 text-red-700 p-4 rounded-lg font-semibold">${err.message}</div>`;
        return;
      }

      // Parse HTML for <a href>
      let links = [];
      try {
        const parser = new DOMParser();
        const doc = parser.parseFromString(html, "text/html");
        links = Array.from(doc.querySelectorAll('a[href]'))
          .map(a => a.href)
          .filter(href => href.startsWith('http'));
        links = Array.from(new Set(links)); // unique
      } catch {
        document.getElementById('results').innerHTML = `<div class="bg-red-100 text-red-700 p-4 rounded-lg font-semibold">Failed to parse HTML!</div>`;
        return;
      }

      if (!links.length) {
        document.getElementById('results').innerHTML = `<div class="bg-yellow-50 text-yellow-700 p-4 rounded-lg font-semibold">No links found on page.</div>`;
        return;
      }

      // Show spinner with progress bar while checking
      document.getElementById('results').innerHTML = `
        <div id="spinner" class="flex flex-col items-center gap-4 mt-4">
          <svg class="animate-spin h-8 w-8 text-rose-600 dark:text-rose-300" viewBox="0 0 50 50">
            <circle class="opacity-20" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="6"/>
            <circle class="opacity-100" cx="25" cy="25" r="20" fill="none" stroke="currentColor" stroke-width="6"
              stroke-linecap="round" stroke-dasharray="60, 200"
              stroke-dashoffset="0"></circle>
          </svg>
          <span class="text-gray-600 dark:text-gray-300">
            Checking <span class="font-bold">${links.length}</span> links...
          </span>
          <div id="progress" class="w-full bg-slate-200 rounded h-2 mt-3 overflow-hidden">
            <div id="progressbar" class="bg-rose-400 h-2 w-0 transition-all"></div>
          </div>
        </div>
      `;

      let checked = 0;
      let results = Array(links.length).fill(null);
      const BATCH_SIZE = 5;
      function sleep(ms) { return new Promise(resolve => setTimeout(resolve, ms)); }

      async function checkLink(lnk, idx) {
        let status = "Checking...";
        try {
          const resp = await fetch(corsProxy + encodeURIComponent(lnk), {
              method: 'HEAD',
              mode: 'cors'
            });
            status = resp.status;
            if (resp.status === 404) status = "404 (dead)";
            else if (resp.status >= 400) status = `${resp.status} (error)`;
            else status = `OK (${resp.status})`;
          } catch {
            // Fallback to GET
            try {
              const resp = await fetch(corsProxy + encodeURIComponent(lnk), { method: 'GET', mode: 'cors' });
              status = resp.status;
              if (resp.status === 404) status = "404 (dead)";
              else if (resp.status >= 400) status = `${resp.status} (error)`;
              else status = `OK (${resp.status})`;
            } catch {
              status = "Request Failed";
            }
          }
        results[idx] = { url: lnk, status };
        checked++;
        // Progress bar
        let pct = Math.round(checked * 100 / links.length);
        document.getElementById('progressbar').style.width = pct + "%";
      }

      // Run link checks in batches
      for (let i = 0; i < links.length; i += BATCH_SIZE) {
        await Promise.all(
          links.slice(i, i + BATCH_SIZE).map((lnk, j) => checkLink(lnk, i + j))
        );
        await sleep(100); // be gentle on proxy
      }

      // ------- All checks done! -------
      // Build final results table
      let tableHTML = `
        <table class="min-w-full table-auto border mt-6 bg-white rounded-xl shadow">
          <thead>
            <tr class="bg-slate-50 text-slate-700">
              <th class="px-4 py-2 text-left font-semibold">Link</th>
              <th class="px-4 py-2 text-left font-semibold">Status</th>
            </tr>
          </thead>
          <tbody>
      `;
      for (let i = 0; i < results.length; ++i) {
        const r = results[i];
        if (!r) continue;
        tableHTML += `
          <tr class="hover:bg-slate-50">
            <td class="px-4 py-2 break-all">
              <a href="${r.url}" target="_blank" class="text-indigo-600 underline hover:text-indigo-900">${r.url}</a>
            </td>
            <td class="px-4 py-2">${getStatusBadge(r.status)}</td>
          </tr>
        `;
      }
      tableHTML += `
          </tbody>
        </table>
      `;

      // Replace spinner/progress with only table
      document.getElementById('results').innerHTML = tableHTML;
    });
  </script>
</body>
</html>
